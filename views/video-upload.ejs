<!DOCTYPE html>
<html>
<head>
  <title>Upload Progress Example</title>
  <link rel="stylesheet" href="\css\index.css">
  <script src="https://cdn.socket.io/4.2.0/socket.io.js"></script>
  <script src="\js\video-validation.js" defer></script>  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="icon" type="image/png"  href="\media\32 x 32 icon.png">
  
  
  <style>
    .progress-wrapper {
      width: 50%;
      margin: 0 auto;
    }
    .progress {
      height: fit-content;
      background-color: transparent;
      padding: 1rem;
      font-weight: 700;
      font-size: medium;
      transition: width 0.5s ease-in-out;
    }


    button.rounded{
    border-radius: 27px !important;
    margin-top: 2rem;
    }

    div.container-new, form{
      display: flex;
      flex-direction: column !important;
      justify-content: center;
      align-items: center;
      margin-top: 3rem;
    }


    #valid, .valid{
      color: #5cb85c;
    }

    #invalid{
      color: #d9534f;
    } 

    .hide{
      display: none;
    }
  </style>
</head>
<body>

  <% if (!activeUser) {%>
    <div class="header-si header-bg">
  
  
      <a href="/posts">
          <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="300px" height="150px" viewBox="0 0 2000 2000">
            <defs>
              <style>
                .cls-1 {
                  font-size: 300px;
                  fill: #1ca78a;
                  font-family: Bahnschrift;
                }
          
                .cls-2 {
                  fill: #fe0000;
                }
              </style>
            </defs>
            <text id="youphonica_" data-name="youphonica  " class="cls-1" x="389.806" y="778.145">youphonica  </text>
            <circle class="cls-2" cx="1563.685" cy="579.687" r="27.125"/>
          </svg>
            
          </a>
  
  
  
  
  
  
          <div class="search-container">
             
                      
                      
                      <div class="sign-in-phone">
                      <a href="/account/sign-in" class="sign-in">
                        <p>sign in</p>
                         
                       </a>
                      </div>
  
  
                    </div>
              </div>
          
      
  
  
  
      <div class="right-cont">
  
  
      <div class="icon-container-nav nav-text account-icon sign-in" id="nav-a">
        <a href="/account/sign-in" class="sign-in">
         <p>sign in</p>
          <span class="nav-icon material-symbols-outlined">
              login
              </span>
        </a>
    </div>        
    </div>
    </div>
    
    </div>
  <% } else {%>
  
    <div class="header-si header-bg">
  
  
      <a href="/posts">
        <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="300px" height="150px" viewBox="0 0 2000 2000">
          <defs>
            <style>
              .cls-1 {
                font-size: 300px;
                fill: #1ca78a;
                font-family: Bahnschrift;
              }
        
              .cls-2 {
                fill: #fe0000;
              }
            </style>
          </defs>
          <text id="youphonica_" data-name="youphonica  " class="cls-1" x="389.806" y="778.145">youphonica  </text>
          <circle class="cls-2" cx="1563.685" cy="579.687" r="27.125"/>
        </svg>
          
        </a>
  
  
  
  
  
  
         
                    <span aria-controls="dropdown-1" class="nav-icon material-symbols-outlined account-icon-phone" onclick="toggledropdown()">
                      account_circle
                      </span>
  
  
  
                      
          
      
  
  
  
  
      <div class="right-cont">
  
  
      <div class="icon-container-nav nav-text account-icon" id="nav-a">
          <span aria-controls="dropdown-1" class="nav-icon material-symbols-outlined">
              account_circle
              </span>
            <br>
          account
  
              <div class="notis">
              <a href="/account/notifications">
              <span class="nav-icon material-symbols-outlined notify-bell">
                notifications
                </span>
              </a>
              <% if(notis === 0){ %>
              <% }else{ %>
              <p class="notis-num"><%= notis %></p>
              <% } %>
          </div>
      </div>        
    </div>
    </div>
      
      <div aria-expanded="false" class="dropdown-1 hide">
            <ul>
              <li>
                <a href="/account/my-accounts">
                my artists <span class="nav-icon material-symbols-outlined icons">
                  groups
                  </span>
                </a>
              </li>
      
              <li><a href="/artists/apply-for-account/pricing">
                apply for artist account <span class="nav-icon material-symbols-outlined icons">
                  music_note
                  </span>
              </a></li>
              <li><a href="/account/upgrade-account">subscriptions 
                <span class="nav-icon material-symbols-outlined icons">
                  paid
                  </span>
              </a></li>
      
              <li><a href="/account/purchases">purchases 
                <span class="nav-icon material-symbols-outlined icons">
                  shopping_cart
                  </span>
              </a></li>
  
  
  
              <li class="phone-notis"><a href="/account/notifications"> 
                <% if(notis === 0){ %>
                  notifications
                  <% }else{ %>
                   <p class="phone-notis-text">notifications <span class="notis-num-phone"><%= notis %></span> </p>
                  <% } %> 
              </a></li>
  
      
            
              <li><a href="/account/account-settings">settings 
                <span class="nav-icon material-symbols-outlined icons">
                  settings
                  </span>
              </a></li>
              <li><a href="/account/sign-out">sign out 
                <span class="nav-icon material-symbols-outlined icons">
                  logout
                  </span>
              </a></li>
            </ul>
          </div>
    </div>
          
  <% } %> 
  
   




   
  <div id="container-new" class="container-new">


  <form enctype="multipart/form-data">


    
    <input type="file" onchange="validateUpload()" class="file" name="file" data-key="video.key" accept=".mp4" required>
    
    <p id="valid"></p>
    
    <p id="invalid"></p>



    <button class="rounded submit" type="submit">Upload</button>

    <br>
    <div class="progress-wrapper">
      <div class="progress" onchange="complete()"></div>
    </div>
  </form>

  

  

  <a href="/find-newest-post">
  <button class="hide link-button">edit post</button>
</a>







<% if(cookies == null || undefined) {%> 
  <div class="cookie-pop-up">
    
   <p>Youphonica uses cookies to make certain aspcets of the site work. <a href="">learn more</a></p> 
      <br>
      <div class="cookie-buttons">
        <form action="/cookies-refuse" method="post">
      <button type="submit" class="cookie-btn reject">reject non-essential
      </button>
    </form>

    <form action="/cookies-accept" method="post">
    <button type="submit" class="cookie-btn accept">accept all</button>
  </form>
    </div>
</div>
<% }else{ %>
<% } %> 
  </div>


<div class="mt-3">
  <%- include('partials/footer')%>   
  </div> 
  </div>

</body>
</html>

<script>

function getRandomInt(min, max) {
  min = Math.ceil(60000);
  max = Math.floor(120000);
  return Math.floor(Math.random() * (max - min) + min); // The maximum is exclusive and the minimum is inclusive
}

const linkBtn = document.querySelector('.link-button')
const progressElement = document.querySelector('.progress');




  const xhr = new XMLHttpRequest();
xhr.upload.onprogress = (event) => {
  if (event.lengthComputable) {
    const progress = event.loaded / event.total * 100;
    console.log('Upload progress:', progress);
    updateProgress(progress);
    if(progress === 100){
      console.log('processing')
      progressElement.innerText = 'processing...'
      const handle = setTimeout(() => {
    console.log('done')
    linkBtn.classList.remove('hide')
    progressElement.innerText = 'finished.'
    clearTimeout(handle);
    }, getRandomInt());
  }
  }

const socket = io('http://localhost:5000');
socket.on('databaseSaveSuccess', (data) => {
        console.log(data.message);
        // Handle the success message from the server after database save
        console.log('Database save result:', data.result);
        // You can access any additi

});
};

const form = document.querySelector('form');
const submit = document.querySelector('.submit');
form.addEventListener('submit', (event) => {
  event.preventDefault();

  const fileInput = document.querySelector('input[type="file"]');
const file = fileInput.files[0];
submit.classList.add('hide')


const formData = new FormData();
formData.append('file', file);

xhr.open('POST', '/upload/test-upload/<%= artist.id %>');
xhr.send(formData);
});


















function updateProgress(progress) {
progressElement.style.width = progress;
var roundedProgress = Math.round(progress)
progressElement.innerText = `${roundedProgress}% uploaded`;

}












</script>